\chapter[{Denotational semantics and domain theory}]{Denotational semantics and \\ domain theory}

Previously we introduced the operational semantics of PCF. Next, we wish to
introduce a \emph{denotational semantics} to PCF. The basic idea is to assign to
each type \(\sigma\) of PCF some kind of \emph{mathematical} object
\(\densem{\sigma}\).
%
A programme \(M\) (i.e.\ closed terms) of type \(\sigma\) is then interpreted as
an element \(\densem{M}\) of \(\densem{\sigma}\).
%
More generally, we extend the interpretation of types to contexts and
\(\Gamma \vdash M : \sigma\) will then be interpreted as a certain function
(morphism) from \(\densem{\Gamma}\) to \(\densem{\sigma}\).

For the denotational semantics we have three desiderata:

\begin{itemize}[itemsep=2mm,topsep=3mm]
\item\emph{Compositionality}: This can be summarised as follows:
  \begin{displayquote}
    \emph{The interpretation of a composite is the composite of the interpretations}.
  \end{displayquote}

  %
  For example, the interpretation of a function type \(\sigma \pcffun \tau\)
  will be a certain set of functions from \(\densem{\sigma}\) to
  \(\densem{\tau}\), and if we have programmes \(M : \sigma \pcffun \tau\) and
  \(N : \sigma\), then \(\densem{M \, N} = \densem{M}(\densem{N})\).
\item\emph{Soundness}: We want our interpretation to respect the operational
  semantics, i.e.\ if we have terms \(M\) and \(N\) with
  \(M \bigstep N\), then their interpretations should be equal.
\item\emph{Computational adequacy}: We should be able to use our
  interpretation to compute, i.e.\ if \(M\) is a programme of type \(\pcfnat\)
  and \(\densem{M} = n\) for some natural number \(n\), then
  \(M \bigstep \numeral{n}\).
\end{itemize}

Soundness and computational adequacy will be proved
in~\cref{chap:soundness-comp-adequacy}, while compositionality will be a direct
consequence of our definitions.

\section{Towards domain theory}

All this leaves the question what kind of mathematical objects we have in mind
for interpreting the types of PCF. A first, naive attempt may be to interpret
each type \(\sigma\) as a set \(\densem{\sigma}\) with:
\begin{align*}
  \densem{\pcfnat} &\coloneqq \text{the set \(\Nat\) of natural numbers}, \text{ and} \\
  \densem{\sigma \pcffun \tau} &\coloneqq \text{the set \(\set{f \colon \densem{\sigma} \to
    \densem{\tau}}\) of all functions from \(\densem{\sigma}\) to \(\densem{\tau}\)}.
\end{align*}

There are two problems with this naive approach.
%
The first problem is that \(\densem{\pcfnat}\) should not only offer natural
numbers, but it should also offer an interpretation of programmes of type
\(\pcfnat\) that do not terminate such as the one
in~\cref{exam:non-termination}.
%
Right now, this programme \(M\) would have to be interpreted as some natural
number \(n\), forcing us to make some arbitrary choice. Moreover, it is not true
that \(M \bigstep \numeral n\), whatever choice we make, so we would violate
computational adequacy.

This problem is easily solved by introducing a new, special element
\(\bot_\sigma \in \densem{\sigma}\) that interprets non-terminating programmes
of type \(\sigma\). And indeed, this will be a part of our eventual interpretation.

However, it does not solve the second, more serious problem, namely that, in
order to interpret PCF's \(\pcffix_\sigma\) we would need every function
\(f \colon \densem{\sigma} \to \densem{\sigma}\) to have a fixed point.
%
But this is easily seen to \emph{false}, e.g. consider
\begin{align*}
  f \colon \Nat \cup \{\bot\} &\to \Nat \cup \{\bot\} \\
  \bot &\mapsto 0, \\
  n &\mapsto n+1.
\end{align*}

This is where domain theory comes to the rescue: Instead of using plain sets, we
will interpret types as so-called \emph{\(\omega\)-cppos}: these are
\emph{partially ordered} sets with a \emph{least} element \(\bot\) and
\emph{least upper bounds} of increasing sequences.
%
A \emph{morphism} between two \(\omega\)-cppos is a function on the underlying
sets that preserves the order and these least upper bounds.
%
The upshot of restricting to such functions is that these morphisms can be shown
to have (least) fixed points, thus solving our second problem.

\section{Basic definitions}

We give the definitions of \(\omega\)-cppos and their morphisms.

\begin{definition}[Poset]
  A \emph{partially ordered set}, or \emph{poset}, is a set \(X\) together with
  a binary relation \({\below}\) satisfying:
  \begin{enumerate}[(i)]
  \item \emph{reflexivity}: for every \(x \in X\), we have \(x \below x\);
  \item \emph{transitivity}: for every \(x,y,z \in X\), if \(x \below y\) and
    \(y \below z\), then \(x \below z\);
  \item \emph{antisymmetry}: for every \(x,y \in X\), if \(x \below y\) and
    \(y \below x\), then \(x = y\).
  \end{enumerate}
\end{definition}

\begin{example}
  The natural numbers, rational numbers and real numbers with their usual
  orderings are all examples of posets.
\end{example}

\begin{definition}[\(\omega\)-chain, least upper bound, \(\omega\)-cpo]
  Let \((X,{\below})\) be a poset.
  \begin{enumerate}[(i)]
  \item An \(\omega\)-chain in \(X\) is a subset
    \(\set{x_0,x_1,x_2,\dots} \subseteq X\) of increasing elements, i.e.\ we
    have \(x_0 \below x_1\), \(x_1 \below x_2\), \(x_2 \below x_3\), and so
    on.% \below \dots\).
  \item An \emph{upper bound} of a subset \(S \subseteq X\) is an element
    \(x \in X\) such that \(s \below x\) for every \(s \in S\).
  \item A \emph{least upper bound} of a subset \(S \subseteq X\) is an upper
    bound \(x \in X\) of \(S\) such that for every upper bound \(y \in X\) of
    \(S\) we have \(x \below y\).
  \item The poset \(X\) is \emph{\(\omega\)-chain complete} if every
    \(\omega\)-chain in \(X\) has a least upper bound.% in \(X\).
  \end{enumerate}
  An \(\omega\)-chain complete poset will be called an \emph{\(\omega\)-cpo}.
\end{definition}

\begin{exercise}\label{exer:least-upper-bounds-are-unique}
  Show that least upper bounds are unique. That is, if \(x\) and \(y\) are least
  upper bounds of some subset \(S\) of a poset \(X\), then \(x = y\).

  \emph{Hint}: Use antisymmetry.
\end{exercise}

Because least upper bounds are unique, we will speak of \emph{the} least upper
bound (of a given subset) and in the case of \(\omega\)-chain
\(x_0 \below x_1 \dots\), we will denote the least upper bound by
\(\bigsqcup_{n \in \Nat}x_n\).

\begin{definition}[Least element, \(\omega\)-cppo]
  Let \((X,{\below})\) be a poset.
  \begin{enumerate}[(i)]
  \item A \emph{least element} of \(X\) is an element \(x \in X\) such that
    \(x \below y\) for every \(y \in X\).
  \item An \(\omega\)-cpo is called \emph{pointed} if it has a least element.
  \end{enumerate}
  A pointed \(\omega\)-cpo will be called an \emph{\(\omega\)-cppo}.
\end{definition}

\begin{exercise}\label{exer:least-element-is-unique}
  Let \(X\) be a poset with a least element \(x\). Show that \(x\) is the least
  upper bound of the empty subset and hence conclude that \(x\) must be unique.
\end{exercise}

Because least elements are unique, we will speak of \emph{the} least element and
will typically denote it by \(\bot\).

\begin{example}[\(\Nat_\bot\)]\label{N-bot}
  A fundamental example of an \(\omega\)-cppo is the \emph{flat} \(\omega\)-cppo
  \(\Nat_\bot\), which is given by the set \(\Nat \cup \{\bot\}\) ordered as
  depicted in the following diagram:
  \[
    \begin{tikzcd}
      0 & 1 & 2 & 3 & \ldots \\
      & & \bot \ar[ull,no head] \ar[ul,no head] \ar[u,no head] \ar[ur, no head]
      \ar[urr, no head]
    \end{tikzcd}
  \]
  Here we interpret a line going up from an element \(x\) to an element \(y\) as
  saying that \(x \below y\).
  %
  Thus, the element \(\bot\) is the least element and all other elements are
  unrelated.
  %
  In particular, we have do \emph{not} have \(0 \below 1\) as in the usual
  ordering of the natural numbers.

  The intuition here is that the partial order \({\below}\) does not reflect the
  numerical value, but rather how ``defined'' an element is with \(\bot\)
  representing an ``undefined''.
  %
  In our interpretation of PCF, we will interpret \(\pcfnat\) as \(\Nat_\bot\)
  and \(\bot\) will serve as an interpretation of non-terminating programmes.
\end{example}

\begin{exercise}\label{exer:N_bot}
  Show that the \(\omega\)-chains in \(\Nat_\bot\) are precisely \(\set{\bot}\),
  \(\set{n}\) and \(\set{\bot,n}\) for a natural number \(n \in \Nat\).
  %
  Use this to check that \(\Nat_\bot\) is indeed an \(\omega\)-cpo.
\end{exercise}

\begin{remark}
  It is perhaps a bit arbitrary that to exhibit
  \(\set{\bot,n} \subseteq \Nat_\bot\) as an \(\omega\)-chain we have to repeat
  elements and order them linearly.
  %
  One way to address this is to replace the notion of \(\omega\)-chain by that
  of a \emph{directed} (see~\cref{exer:directedness}) subset, and to consider
  \emph{dcpos}: posets with least upper bounds for all directed subsets.

  For general domain theory the notion of dcpo is arguably the better notion
  (see also~\cite[Section~2.2.4]{AbramskyJung1994}, but for the denotational
  semantics of PCF and in particular, the existence of least fixed
  points~(\cref{least-fixed-point}), the notion of \(\omega\)-cpo suffices.
\end{remark}

\begin{exercise}\label{exer:directedness}
  Let \((X,{\below})\) be a poset. A subset \(S \subseteq X\) is \emph{directed}
  if it is non-empty and for every two elements \(x,y \in S\), there exists a
  element \(z \in S\) with \(x \below z\) and \(y \below z\).
  \begin{enumerate}[(i)]
  \item Show that every \(\omega\)-chain is a directed subset.
  \item Conversely, use the axiom of choice to show that every countable,
    directed subset is an \(\omega\)-chain.
  \end{enumerate}
\end{exercise}

We proceed by defining the morphisms of (pointed) \(\omega\)-cpos.
\begin{definition}[Morphism of \(\omega\)-cpos]\label{def:morphism}
  A \emph{morphism} between two \(\omega\)-cpos \(A\) and \(B\) is a function
  \(f\) on the underlying sets of \(A\) and \(B\) such that
  \begin{enumerate}[(i)]
  \item\label{monotone} it is \emph{monotone} (or \emph{order preserving}),
    i.e.\ if \(x \below y\) in \(A\), then \(f(x) \below f(y)\) in \(B\);
  \item\label{preserve-lub-of-omega-chains} it \emph{preserves least upper
      bounds of \(\omega\)-chains}, i.e.\ if \(\set{x_0,x_1,\dots}\) is an
    \(\omega\)-chain in \(A\) with least upper bound \(a\), then \(f(a)\) is the
    least upper bound in \(B\) of the subset \(\set{f(x_0),f(x_1),\dots}\).
  \end{enumerate}
\end{definition}

It follows from monotonicity that \(\set{f(x_0),f(x_1),\dots}\) is an
\(\omega\)-chain in \(B\) and hence we could rewrite the second condition as:
\[
  f\pa*{\textstyle\bigsqcup_{n \in \Nat}x_n} = \textstyle\bigsqcup_{n \in
    \Nat}f(x_n).
\]
%
But actually, monotonicity is redundant as the following exercise ask you to
check:

\begin{exercise}\label{exer:monotonicity-follows}
  Show that if a function \(f\) between \(\omega\)-cpos satisfies
  item~\ref{preserve-lub-of-omega-chains} of~\cref{def:morphism}, then \(f\)
  must be monotone.

  \emph{Hint}: If \(x \below y\), then \(\set{x,y}\) is an \(\omega\)-chain with
  least upper bound \(y\).
\end{exercise}

The point of introducing morphisms of \(\omega\)-cpos is made clear by the
following fundamental result:

\begin{theorem}[Knaster--Tarski fixed point theorem]\label{least-fixed-point}
  Every morphism \(f \colon X \to X\) on an \(\omega\)-cpo \(X\) has a least
  fixed point given by the least upper bound of the \(\omega\)-chain
  \[
    \bot \below f(\bot) \below f(f(\bot)) \dots.
  \]
\end{theorem}
\begin{proof}[Proof sketch]
  We write \(f^n(\bot)\) for the \(n\)-fold application of \(f\) to the least
  element \(\bot\).
  %
  We first check that \(\set{f^n(\bot) \mid n \in \Nat}\) is indeed an
  \(\omega\)-chain.
  %
  Since \(\bot\) is the least element, we certainly have
  \(\bot \below f(\bot)\). But now we also have \(f(\bot) \below f^2(\bot)\) by
  monotonicity of \(f\). It follows by induction on \(n\) that
  \(f^n(\bot) \below f^{n+1}(\bot)\), as desired.
  %
  Now we calculate:
  \begin{align*}
    f\pa*{\textstyle\bigsqcup_{n \in \Nat}f_n(\bot)}
    &= \bigsqcup_{n \in \Nat}f\pa*{f^n(\bot)}
    &\text{(since \(f\) preserves least upper bounds of \(\omega\)-chains)} \\
    &= \bigsqcup_{n \in \Nat}f^{n+1}(\bot)
    &\text{(by definition)} \\
    &= \bigsqcup_{n \in \Nat}f^{n}(\bot)
    &\text{(by antisymmetry and calculation)}
  \end{align*}
  so we have a fixed point, as claimed. That it is the least follows
  from~\cref{exer:least-fixed-point}.
\end{proof}

\begin{exercise}\label{exer:least-fixed-point}
  Write \(x_0\) for the fixed point constructed in~\cref{least-fixed-point}.
  %
  Show that for every \(y \in X\) with \(f(y) \below y\), we have \(x_0 \below y\).
  %
  Conclude that \(x_0\) is indeed the \emph{least} fixed point.
\end{exercise}


\section{Products}

\section{Exponentials}


\section{List of exercises}
\begin{enumerate}
\item \cref{exer:least-upper-bounds-are-unique}: On the uniqueness of least upper bounds.
\item \cref{exer:least-element-is-unique}: On the uniqueness of least elements.
\item \cref{exer:N_bot}: On \(\omega\)-chains in \(\Nat_\bot\).
\item \cref{exer:directedness}: On directed subsets and \(\omega\)-chains.
\item \cref{exer:monotonicity-follows}: On deriving monotonicity from preservation of
  least upper bounds of \(\omega\)-chains.
\item \cref{least-fixed-point}: On showing that the Knaster--Tarski fixed point
  is the least.
\end{enumerate}

%%% Local Variables:
%%% mode: latexmk
%%% TeX-master: "../main"
%%% End:
